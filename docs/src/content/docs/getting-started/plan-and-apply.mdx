---
title: Plan and Apply
description: Understanding and using Terraform Plan and Apply operations with Terrateam
---
import { Steps } from '@astrojs/starlight/components';
import { Card, CardGrid } from '@astrojs/starlight/components';

The Plan and Apply operations are the core of Terrateam's functionality. They allow you to preview and execute changes to your infrastructure in a controlled and collaborative manner.

## Plan

The Plan operation generates a preview of changes that will be made to your infrastructure when you apply your Terraform code. This preview is called a "plan" in Terraform terminology.

The following example shows a common usage of the plan feature, enabling you to review changes and collaborate with your team before the changes are applied:
<Steps>
1. Open a pull request with changes to your Terraform code.

   ![Terrateam pull request](../../../assets/nibbler-pull-request.png)

2. Terrateam automatically triggers a Plan operation.

3. Review the plan output in the PR comment. It shows what will be created, modified, or destroyed:

    ![Terrateam plan](../../../assets/nibbler-terrateam-plan.png)

</Steps>

You can manually trigger another Plan by commenting `terrateam plan` on the pull request.

:::note
Plans are read-only operations that don't change your infrastructure, so they're safe to run repeatedly as you refine your code.
:::

## Apply

The Apply operation executes the changes previewed in the Plan. This is when actual infrastructure changes occur.
Here's an example of a common usage of the apply feature:
<Steps>
1. Ensure your pull request has a successful Plan operation.

2. Comment `terrateam apply` on the pull request.

3. Terrateam acquires a lock on the affected directories to prevent conflicting changes.

4. Terrateam runs the Apply operation:

   ![Terrateam Apply](../../../assets/nibbler-terrateam-apply.png)

5. Verify the apply was successful by reviewing the output.

6. Merge the pull request to complete your workflow.

7. Terrateam automatically releases the lock.
</Steps>

:::caution
If another PR is trying to apply changes to the same directory, it will be blocked until the [current lock is released](/advanced-workflows/locks-and-concurrency/). Locks prevent conflicting changes from being applied simultaneously.
:::



### Apply Requirements

Terrateam has a set of [Apply Requirements](/configuration-reference/apply-requirements) that must be met before an Apply operation can be triggered. These include:

- Requiring a certain number of [approvals](/configuration-reference/apply-requirements#approved) on the pull request.
- Ensuring there are no [merge conflicts](/configuration-reference/apply-requirements#merge-conflicts).
- Checking that all [status checks](/configuration-reference/apply-requirements#status-checks) have passed.

You can configure these requirements in your [Terrateam configuration file](/getting-started/configuration).
### Auto-Apply
If you want to automatically apply changes when a pull request is merged, you can use the [When Modified](/configuration-reference/when-modified) feature. This is useful for repositories where merged changes are always expected to be applied, like production environments.
```yaml
when_modified:
  autoapply: true
```
:::note 
   Auto-Apply is disabled by default to prevent accidental changes to your infrastructure.
:::
## Apply Workflows: Pre-merge vs Post-merge
Terrateam offers two primary workflows based on when changes are applied. These workflows determine the timing and process of applying changes to your infrastructure, providing flexibility to suit different environments and requirements.

Workflows in Terrateam define the sequence of steps that are executed during the Plan and Apply operations. They allow you to customize the behavior of these operations to fit your specific needs. 

For stability-critical environments, consider a pre-merge workflow with [automerge](/configuration-reference/automerge) for balanced validation and efficiency.
