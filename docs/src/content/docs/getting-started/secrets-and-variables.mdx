---
title: Secrets and Variables
description: Using secrets, variables, and tfvars in Terrateam
---
import { Tabs, TabItem } from '@astrojs/starlight/components';

Terrateam provides several ways to manage sensitive information and customize your Terraform configurations using secrets, variables, and tfvars files. This guide will walk you through how to create and use secrets, set environment variables, and use tfvars files to manage your Terraform variables.

## GitHub Secrets and Variables

### Environment Variables

GitHub [Secrets](https://docs.github.com/en/actions/security-guides/encrypted-secrets) and [Variables](https://docs.github.com/en/actions/learn-github-actions/variables) can be used to set environment variables. They are translated into environment variables in the Terrateam GitHub Action runtime environment. These environment variables may be referenced in your Terraform code.

**Example: Defining a GitHub Secret**

```bash
# Using GitHub CLI to create a secret
gh secret set AWS_ACCESS_KEY_ID --body "AKIAIOSFODNN7EXAMPLE"

# Using GitHub Web Interface
# Navigate to your repository → Settings → Secrets and variables → Actions → New repository secret
# Name: AWS_ACCESS_KEY_ID
# Value: AKIAIOSFODNN7EXAMPLE
```

After adding a secret, you can reference it in Terrateam. The following code snippet shows how to use the previously created secret (`AWS_ACCESS_KEY_ID`) in the [ADD THE FILE NAME HERE].

```hcl
provider "aws" {
  region     = "us-west-2"
  access_key = var.aws_access_key_id
  secret_key = var.aws_secret_access_key
}

variable "aws_access_key_id" {
  description = "AWS Access Key ID"
  type        = string
  sensitive   = true
}

variable "aws_secret_access_key" {
  description = "AWS Secret Access Key"
  type        = string
  sensitive   = true
}
```

### Using TF_VAR Environment Variables

*Secrets and variables that start with* `TF_VAR_` *are treated specially by Terrateam.*

GitHub secrets and variables are always uppercase, however by convention Terraform variables are lowercase. Terrateam automatically finds all secrets that start with `TF_VAR_` and creates a new environment variable that has the lowercase name. If the lowercase name exists, no action is taken. The uppercase environment variable is left unchanged. 

If you use the GitHub CLI to generate a secret named `TF_VAR_DATABASE_PASSWORD`:

```bash
# Setting a GitHub secret
gh secret set TF_VAR_DATABASE_PASSWORD --body "super-secret-password"
```

This will create an environment variable `TF_VAR_database_password` which Terraform can automatically map to a variable named `database_password` in your Terraform configuration.

```hcl
variable "database_password" {
  description = "Password for database connection"
  type        = string
  sensitive   = true
}

resource "aws_db_instance" "example" {
  # Other configuration...
  password = var.database_password
}
```

### Security

GitHub secrets are stored encrypted at rest using a [libsodium sealed box](https://libsodium.gitbook.io/doc/public-key_cryptography/sealed_boxes) and are only decrypted when used in GitHub Actions workflows. 

When Terrateam runs your Terraform operations:
1. Encrypted secrets are decrypted within the GitHub Actions runtime
2. Decrypted secrets are available as environment variables within the GitHub Actions runner
3. Your sensitive data appears only in the encrypted Terraform plan files
4. Terrateam does not store your unencrypted secrets on its servers

The Terraform plan files, which may contain your secrets, are stored temporarily during the planning and application process, then deleted.

## Hooks and Workflows

Terrateam also allows you to set environment variables using [Hooks](/configuration-reference/hooks) and [Workflows](/configuration-reference/workflows).

### Hooks

You can set an environment variable at the very start of a Terrateam operation using Hooks.

```yaml
hooks:
  plan:
    pre:
      - type: env
        name: FOO
        cmd: ['echo', 'BAR']
  apply:
    pre:
      - type: env
        name: BAZ
        cmd: ['echo', 'QUX']
```

The following code snippet shows how to set a dynamic environment variable based on the current Git branch:

```yaml
hooks:
  plan:
    pre:
      - type: env
        name: ENVIRONMENT
        cmd: ['bash', '-c', 'echo $(git branch --show-current | cut -d "/" -f2)']
```

### Workflows

You can also set an environment variable at the start of each Plan and Apply operation.

```yaml
workflows:
  - tag_query: ""
    plan:
      - type: init
      - type: env
        name: FOO
        cmd: ["echo", "BAR"]
      - type: plan
    apply:
      - type: init
      - type: env
        name: FOO
        cmd: ["echo", "BAR"]
      - type: apply
```

**Example use case:** Setting a timestamp for resource tagging:

```yaml
workflows:
  - tag_query: ""
    plan:
      - type: init
      - type: env
        name: TF_VAR_deployment_timestamp
        cmd: ["date", "+%Y%m%d%H%M%S"]
      - type: plan
```

## `.tfvars` Files

Terraform allows you to define variables in `.tfvars` files, which can be used to customize your Terraform configurations.

To use a tfvars file with Terrateam, you can specify the file path in your workflow configuration using the `extra_args` option.

```yaml
workflows:
  - tag_query: ""
    plan:
      - type: init
      - type: plan
        extra_args: ["-var-file=qa.tfvars"]
    apply:
      - type: init
      - type: apply
```

**Example of a `.tfvars` file:**

```hcl
# qa.tfvars
region        = "us-west-2"
instance_type = "t3.micro"
vpc_cidr      = "10.0.0.0/16"
environment   = "qa"
```

In this example, the `qa.tfvars` file will be used during the plan step, providing environment-specific variable values to your Terraform configuration.