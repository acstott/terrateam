#!/bin/sh
#
# Copyright (c) 2013 Mark Heily <mark@heily.com>
#
# Permission to use, copy, modify, and distribute this software for any
# purpose with or without fee is hereby granted, provided that the above
# copyright notice and this permission notice appear in all copies.
# 
# THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
# WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
# MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
# ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
# WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
# ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
# OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
#
   
usage() {
cat << "EOF"
Usage: configure [options]

Installation options:
        --bindir [DIRECTORY]         TODO describe this [$(EPREFIX)/bin]
        --datadir [DIRECTORY]        TODO describe this [$(DATAROOTDIR)]
        --datarootdir [DIRECTORY]    TODO describe this [$(PREFIX)/share]
        --docdir [DIRECTORY]         TODO describe this [$(DATAROOTDIR)/doc/$(PACKAGE)]
        --eprefix [DIRECTORY]        TODO describe this [$(PREFIX)]
        --includedir [DIRECTORY]     TODO describe this [$(PREFIX)/include]
        --infodir [DIRECTORY]        TODO describe this [$(DATAROOTDIR)/info]
        --libdir [DIRECTORY]         TODO describe this [$(EPREFIX)/lib]
        --libexecdir [DIRECTORY]     TODO describe this [$(EPREFIX)/libexec]
        --localedir [DIRECTORY]      TODO describe this [$(DATAROOTDIR)/locale]
        --localstatedir [DIRECTORY]  TODO describe this [$(PREFIX)/var]
        --mandir [DIRECTORY]         TODO describe this [$(DATAROOTDIR)/man]
        --oldincludedir [DIRECTORY]  TODO describe this [/usr/include]
        --pkgdatadir [DIRECTORY]     TODO describe this [$(DATADIR)/$(PACKAGE)]
        --pkgincludedir [DIRECTORY]  TODO describe this [$(INCLUDEDIR)/$(PACKAGE)]
        --pkglibdir [DIRECTORY]      TODO describe this [$(LIBDIR)/$(PACKAGE)]
        --prefix [DIRECTORY]         TODO describe this [/usr/local]
        --sbindir [DIRECTORY]        TODO describe this [$(EPREFIX)/sbin]
        --sharedstatedir [DIRECTORY] TODO describe this [$(PREFIX)/com]
        --sysconfdir [DIRECTORY]     TODO describe this [$(PREFIX)/etc]

Project options:

System types:
        --build BUILD                set the system type for building
        --host HOST                  cross-compile programs to run on a different system type
        --target TARGET              build a compiler for cross-compiling

Optional Features:

Common options:
        --disable-static             Disable generation of static libraries
        --disable-option-checking
    -h, --help                       Show this message
    -V, --version                    Display version information and exit
EOF
}

echo "# Automatically generated by ./configure -- do not edit" > config.mk
for arg in $*
do
  if [ `echo "$arg" | grep "^--"` = "$arg" ] ; then
     key=`echo $arg | sed "s/^--//; s/=.*//"`
     val=`echo $arg | sed "s/.*=//"`
     uc_key=`echo "$key" | tr "a-z" "A-Z" | tr "-" "_"`
     echo key=$key -- val=$val
     case $key in
     "help")
       usage
       exit 1
       ;;
     bindir|datadir|datarootdir|docdir|eprefix|includedir|infodir|libdir|libexecdir|localedir|localstatedir|mandir|pkgdatadir|pkgincludedir|pkglibdir|prefix|sbindir|sharedstatedir|sysconfdir)
       echo "$uc_key=$val" >> config.mk
       ;;
     disable-static)
       echo "$uc_key=1" >> config.mk
       ;;
     disable-option-checking)
        # Not implemented, this behavior is the default (for now)
        ;;
     *)
       echo "Warning: unrecognized option: $arg"
       ;;
     esac
  fi
done

rm -f config.h
make config.h
